# Upper Body Extraction Tool

è¿™ä¸ªå·¥å…·å¯ä»¥ä»è§†é¢‘ä¸­è‡ªåŠ¨æå–äººä½“çš„ä¸ŠåŠèº«åŒºåŸŸï¼Œä½¿ç”¨ YOLO pose æ£€æµ‹æ¥ç²¾ç¡®å®šä½è‚©è†€å’Œè…°éƒ¨å…³é”®ç‚¹ã€‚

## ç‰ˆæœ¬è¯´æ˜

- **å•çº¿ç¨‹ç‰ˆæœ¬** (`extract_upper_body.py`) - ç®€å•æ˜“ç”¨ï¼Œé€‚åˆå°è§†é¢‘å¤„ç†
- **å¤šçº¿ç¨‹ç‰ˆæœ¬** (`extract_upper_body_mt.py`) - é«˜æ€§èƒ½ï¼Œé€‚åˆå¤§è§†é¢‘æ‰¹é‡å¤„ç†

## åŠŸèƒ½ç‰¹æ€§

- ğŸ“¹ æ”¯æŒå„ç§è§†é¢‘æ ¼å¼ (mp4, avi, mov, etc.)
- ğŸ¯ åŸºäºäººä½“å…³é”®ç‚¹ç²¾ç¡®è£å‰ªä¸ŠåŠèº«åŒºåŸŸ
- âš¡ GPU åŠ é€Ÿæ¨ç†
- ğŸšï¸ å¯æ§åˆ¶æŠ½å¸§é¢‘ç‡
- ğŸ› å¯é€‰æ‹©ä¿å­˜è°ƒè¯•å¸§ï¼ˆå¸¦å…³é”®ç‚¹æ ‡æ³¨ï¼‰
- ğŸ“Š è¯¦ç»†çš„å¤„ç†ç»Ÿè®¡ä¿¡æ¯

## å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ç”¨æ³•

```bash
# å¤„ç†è§†é¢‘ï¼Œæ¯30å¸§æŠ½å–ä¸€æ¬¡
python tools/extract_upper_body.py video.mp4

# å¤„ç†è§†é¢‘ï¼Œæ¯10å¸§æŠ½å–ä¸€æ¬¡
python tools/extract_upper_body.py video.mp4 --interval 10

# è‡ªå®šä¹‰è¾“å‡ºç›®å½•
python tools/extract_upper_body.py video.mp4 --output my_crops
```

### é«˜çº§ç”¨æ³•

```bash
# å®Œæ•´å‚æ•°ç¤ºä¾‹
python tools/extract_upper_body.py video.mp4 \
    --pose-model models/yolo11m-pose.pt \
    --output upper_body_crops \
    --interval 30 \
    --confidence 0.7 \
    --prefix tshirt_data \
    --debug \
    --margin 0.15
```

## å‚æ•°è¯´æ˜

| å‚æ•° | çŸ­å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|-------|--------|------|
| `video` | - | - | è¾“å…¥è§†é¢‘æ–‡ä»¶è·¯å¾„ |
| `--pose-model` | - | `models/yolo11m-pose.pt` | pose æ£€æµ‹æ¨¡å‹è·¯å¾„ |
| `--output` | `-o` | `upper_body_crops` | è¾“å‡ºç›®å½• |
| `--interval` | `-i` | `30` | æŠ½å¸§é—´éš”ï¼ˆ1=æ¯å¸§ï¼Œ30=æ¯30å¸§ï¼‰ |
| `--confidence` | `-c` | `0.5` | äººä½“æ£€æµ‹æœ€å°ç½®ä¿¡åº¦ |
| `--prefix` | `-p` | `upper_body` | ä¿å­˜å›¾ç‰‡çš„æ–‡ä»¶åå‰ç¼€ |
| `--debug` | - | `False` | ä¿å­˜å¸¦å…³é”®ç‚¹æ ‡æ³¨çš„è°ƒè¯•å¸§ |
| `--margin` | `-m` | `0.1` | è£å‰ªè¾¹è·æ¯”ä¾‹ |

## è¾“å‡ºæ–‡ä»¶

### è£å‰ªå›¾ç‰‡å‘½åè§„åˆ™
```
{prefix}_{video_name}_frame{frame_number}_person{person_index}.jpg
```

ä¾‹å¦‚ï¼š`upper_body_myvideo_frame000030_person0.jpg`

### ç›®å½•ç»“æ„
```
upper_body_crops/
â”œâ”€â”€ upper_body_myvideo_frame000030_person0.jpg
â”œâ”€â”€ upper_body_myvideo_frame000060_person0.jpg
â”œâ”€â”€ upper_body_myvideo_frame000060_person1.jpg
â””â”€â”€ debug_frames/  (if --debug enabled)
    â”œâ”€â”€ debug_myvideo_frame000030.jpg
    â””â”€â”€ debug_myvideo_frame000060.jpg
```

## ä½¿ç”¨æ¡ˆä¾‹

### 1. ä¸ºçŸ­è¢–åˆ†ç±»å™¨æ”¶é›†æ•°æ®
```bash
# æ¯15å¸§æŠ½å–ä¸€æ¬¡ï¼Œé«˜ç½®ä¿¡åº¦ï¼Œä¿å­˜è°ƒè¯•å¸§
python tools/extract_upper_body.py training_video.mp4 \
    --interval 15 \
    --confidence 0.8 \
    --prefix tshirt_train \
    --debug
```

### 2. å¿«é€Ÿæµè§ˆè§†é¢‘å†…å®¹
```bash
# æ¯60å¸§æŠ½å–ä¸€æ¬¡ï¼ˆçº¦æ¯2ç§’ï¼‰
python tools/extract_upper_body.py content_video.mp4 \
    --interval 60 \
    --prefix preview
```

### 3. é«˜ç²¾åº¦æ•°æ®æ”¶é›†
```bash
# æ¯5å¸§æŠ½å–ï¼Œå¤§è¾¹è·ï¼Œä½ç½®ä¿¡åº¦é˜ˆå€¼
python tools/extract_upper_body.py high_quality_video.mp4 \
    --interval 5 \
    --margin 0.2 \
    --confidence 0.3 \
    --prefix high_quality
```

## å¤šçº¿ç¨‹ç‰ˆæœ¬ä½¿ç”¨

å¯¹äºå¤§è§†é¢‘æˆ–éœ€è¦é«˜æ€§èƒ½å¤„ç†çš„æƒ…å†µï¼Œæ¨èä½¿ç”¨å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼š

### åŸºæœ¬ç”¨æ³•
```bash
# ä½¿ç”¨é»˜è®¤é…ç½®ï¼ˆ4ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œæ‰¹å¤„ç†å¤§å°4ï¼‰
python tools/extract_upper_body_mt.py video.mp4

# è‡ªå®šä¹‰çº¿ç¨‹æ•°å’Œæ‰¹å¤„ç†å¤§å°
python tools/extract_upper_body_mt.py video.mp4 \
    --workers 8 \
    --batch-size 8
```

### å¤šçº¿ç¨‹å‚æ•°

åœ¨åŸºæœ¬å‚æ•°åŸºç¡€ä¸Šï¼Œå¤šçº¿ç¨‹ç‰ˆæœ¬å¢åŠ äº†ï¼š

| å‚æ•° | çŸ­å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|-------|--------|------|
| `--workers` | `-w` | `4` | å·¥ä½œçº¿ç¨‹æ•°é‡ |
| `--batch-size` | `-b` | `4` | æ¨ç†æ‰¹å¤„ç†å¤§å° |

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **GPU å†…å­˜è¶³å¤Ÿ** (8GB+)ï¼š
   ```bash
   python tools/extract_upper_body_mt.py video.mp4 \
       --workers 6 \
       --batch-size 8
   ```

2. **GPU å†…å­˜ä¸­ç­‰** (4-8GB)ï¼š
   ```bash
   python tools/extract_upper_body_mt.py video.mp4 \
       --workers 4 \
       --batch-size 4
   ```

3. **GPU å†…å­˜è¾ƒå°** (<4GB)ï¼š
   ```bash
   python tools/extract_upper_body_mt.py video.mp4 \
       --workers 2 \
       --batch-size 2
   ```

### å¤šçº¿ç¨‹ç‰ˆæœ¬ä¼˜åŠ¿

- ğŸš€ **æ›´é«˜çš„GPUåˆ©ç”¨ç‡** - æ‰¹å¤„ç†æ¨ç†ï¼Œå‡å°‘GPUç©ºé—²æ—¶é—´
- âš™ï¸ **å¹¶è¡Œå¤„ç†** - å¤šçº¿ç¨‹å¹¶è¡Œå¤„ç†ä¸åŒå¸§
- ğŸ’¾ **å¼‚æ­¥IO** - ä¿å­˜å›¾ç‰‡ä¸é˜»å¡æ¨ç†çº¿ç¨‹
- ğŸ“Š **å®æ—¶ç›‘æ§** - å®æ—¶æ˜¾ç¤ºå¤„ç†è¿›åº¦å’Œæ€§èƒ½æŒ‡æ ‡

### æ€§èƒ½å¯¹æ¯”

åœ¨ RTX 4090 + 16GB å†…å­˜ä¸Šçš„æµ‹è¯•ç»“æœï¼š

| ç‰ˆæœ¬ | å¤„ç†é€Ÿåº¦ | GPUåˆ©ç”¨ç‡ | å†…å­˜å ç”¨ | é€‚ç”¨åœºæ™¯ |
|------|--------|---------|---------|--------|
| å•çº¿ç¨‹ | 15-20 FPS | 60-70% | 2-3 GB | å°è§†é¢‘ã€è°ƒè¯• |
| å¤šçº¿ç¨‹ (4çº¿ç¨‹) | 40-60 FPS | 85-95% | 4-6 GB | å¤§è§†é¢‘ã€æ‰¹é‡å¤„ç† |
| å¤šçº¿ç¨‹ (8çº¿ç¨‹) | 60-80 FPS | 90-98% | 6-8 GB | æé™æ€§èƒ½ |

### ç›‘æ§ä¿¡æ¯

å¤šçº¿ç¨‹ç‰ˆæœ¬ä¼šæ¯5ç§’è¾“å‡ºè¿›åº¦ä¿¡æ¯ï¼š
```
progress: read=150, processed=142, saved=285, fps=28.4, queue_size=8
```

- `read`: å·²è¯»å–å¸§æ•°
- `processed`: å·²å¤„ç†å¸§æ•°  
- `saved`: å·²ä¿å­˜å›¾ç‰‡æ•°
- `fps`: å¹³å‡å¤„ç†å¸§ç‡
- `queue_size`: å½“å‰é˜Ÿåˆ—å¤§å°

## æŠ€æœ¯ç»†èŠ‚

### å…³é”®ç‚¹æ£€æµ‹
ä½¿ç”¨ YOLO11m-pose æ¨¡å‹æ£€æµ‹ 17 ä¸ª COCO æ ¼å¼å…³é”®ç‚¹ï¼š
- è‚©è†€ï¼šç´¢å¼• 5ï¼ˆå·¦è‚©ï¼‰ï¼Œ6ï¼ˆå³è‚©ï¼‰
- è…°éƒ¨ï¼šç´¢å¼• 11ï¼ˆå·¦é«‹ï¼‰ï¼Œ12ï¼ˆå³é«‹ï¼‰

### è£å‰ªé€»è¾‘
1. æ‰¾åˆ°è‚©è†€æœ€é«˜ç‚¹ï¼ˆyå€¼æœ€å°ï¼‰
2. æ‰¾åˆ°è…°éƒ¨æœ€ä½ç‚¹ï¼ˆyå€¼æœ€å¤§ï¼‰
3. ä½¿ç”¨äººä½“ bbox çš„ x è¾¹ç•Œ
4. æ·»åŠ æŒ‡å®šæ¯”ä¾‹çš„è¾¹è·
5. ç¡®ä¿è¾¹ç•Œåœ¨å›¾åƒèŒƒå›´å†…

### æ€§èƒ½ä¼˜åŒ–
- GPU è‡ªåŠ¨æ£€æµ‹å’Œä½¿ç”¨
- æ¨¡å‹é¢„çƒ­å‡å°‘é¦–æ¬¡æ¨ç†å»¶è¿Ÿ
- æ‰¹å¤„ç†æ¨ç†ï¼ˆå¦‚æœéœ€è¦å¯ä»¥æ‰©å±•ï¼‰

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: æç¤ºæ‰¾ä¸åˆ° pose æ¨¡å‹ï¼Ÿ**
A: ç¡®ä¿ `models/yolo11m-pose.pt` æ–‡ä»¶å­˜åœ¨ï¼Œæˆ–ä½¿ç”¨ `--pose-model` å‚æ•°æŒ‡å®šæ­£ç¡®è·¯å¾„ã€‚

**Q: è£å‰ªçš„ä¸ŠåŠèº«åŒºåŸŸå¤ªå°ï¼Ÿ**
A: å°è¯•å¢åŠ  `--margin` å‚æ•°å€¼ï¼Œä¾‹å¦‚ `--margin 0.2`ã€‚

**Q: å¤„ç†é€Ÿåº¦å¤ªæ…¢ï¼Ÿ**
A: å¢åŠ  `--interval` å‚æ•°å€¼æ¥å‡å°‘å¤„ç†çš„å¸§æ•°ï¼Œæˆ–ç¡®ä¿ä½¿ç”¨ GPUã€‚

**Q: æ£€æµ‹ä¸åˆ°äººï¼Ÿ**
A: é™ä½ `--confidence` å‚æ•°å€¼ï¼Œä¾‹å¦‚ `--confidence 0.3`ã€‚

## ä¾èµ–è¦æ±‚

- Python 3.8+
- ultralytics
- opencv-python
- torch
- loguru
- numpy

## æ€§èƒ½å‚è€ƒ

åœ¨ RTX 4090 ä¸Šçš„å¤§è‡´æ€§èƒ½ï¼š
- 1080p è§†é¢‘ï¼šçº¦ 15-20 FPS
- æ¯å¤„ç† 1000 å¸§çº¦éœ€ 1-2 åˆ†é’Ÿ
- å†…å­˜å ç”¨ï¼šçº¦ 2-4 GB
